<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamiczne listy - Admin</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f3f3f3; }
  header { background:#4caf50; color:white; padding:20px; text-align:center; }
  #loginScreen { text-align:center; margin-top:50px; }
  #loginScreen input, #loginScreen button { padding:10px; margin:5px; font-size:14px; }
  #mainContent { display:none; padding:20px; position:relative; }
  .panel { position:fixed; top:0; bottom:0; width:250px; background:#333; color:white; overflow:auto; transition:0.3s; padding:10px; }
  #leftPanel { left:-230px; }
  #rightPanel { right:-230px; }
  .panel button { margin-top:10px; padding:10px; width:90%; }
  .panel h3 { margin-top:0; }
  .toggle-btn { position:fixed; top:20px; width:30px; height:30px; background:#4caf50; color:white; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:bold; z-index:1000; }
  #leftToggle { left:0; }
  #rightToggle { right:0; }
  table { width:90%; margin:20px auto; border-collapse:collapse; background:white; }
  th, td { border:1px solid #ddd; padding:10px; text-align:center; }
  th { background:#4caf50; color:white; }
  tr:nth-child(even) { background:#f9f9f9; }
  tr:hover { background:#e0f7e9; }
  form input, form select, form button { margin:5px; padding:5px; }
</style>
</head>
<body>
<header>
  <h1>Dynamiczne listy üè°</h1>
</header>

<div id="loginScreen">
  <h2>Wprowad≈∫ has≈Ço</h2>
  <input type="password" id="passwordInput" placeholder="Has≈Ço">
  <button id="loginBtn">Zaloguj</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="mainContent">
  <!-- Toggle Buttons -->
  <div class="toggle-btn" id="leftToggle">&#9776;</div>
  <div class="toggle-btn" id="rightToggle">&#9881;</div>

  <!-- Panels -->
  <div class="panel" id="leftPanel">
    <h3>Nowe listy (Admin)</h3>
    <input type="text" id="newListName" placeholder="Nazwa listy"><br>
    <input type="text" id="newListColumns" placeholder="Kolumny np: Co,Ile,Zrobione"><br>
    <label><input type="checkbox" id="newListDate"> Dodaj datƒô</label><br>
    <label><input type="checkbox" id="newListCheckbox"> Dodaj checkbox</label><br>
    <button id="createListBtn">Utw√≥rz listƒô</button>
  </div>

  <div class="panel" id="rightPanel">
    <h3>Filtry</h3>
    <div id="filterArea"></div>
  </div>

  <!-- Listy dynamiczne -->
  <div id="listsContainer"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDeH4Ouu8XU09atWJMsawPrEsUCDTd8Pzo",
  authDomain: "obowiazki-domowe-b2312.firebaseapp.com",
  databaseURL: "https://obowiazki-domowe-b2312-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "obowiazki-domowe-b2312",
  storageBucket: "obowiazki-domowe-b2312.firebasestorage.app",
  messagingSenderId: "348397631566",
  appId: "1:348397631566:web:fef9f724dbf737b8cf6b1f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const listsRef = db.ref("lists");

// Login
const loginScreen = document.getElementById("loginScreen");
const mainContent = document.getElementById("mainContent");
const loginBtn = document.getElementById("loginBtn");
const passwordInput = document.getElementById("passwordInput");
const loginError = document.getElementById("loginError");
let isAdmin = false;

loginBtn.addEventListener("click", () => {
  const pw = passwordInput.value;
  if(pw === "admin123!"){ isAdmin=true; } 
  else if(pw === "lista123!"){ isAdmin=false; }
  else { loginError.textContent="Nieprawid≈Çowe has≈Ço"; passwordInput.value=""; return; }

  loginScreen.style.display="none";
  mainContent.style.display="block";
  loadLists();
});

// Toggle panels
const leftPanel = document.getElementById("leftPanel");
const rightPanel = document.getElementById("rightPanel");
const leftToggle = document.getElementById("leftToggle");
const rightToggle = document.getElementById("rightToggle");

leftToggle.addEventListener("click",()=>{ leftPanel.style.left = (leftPanel.style.left=="0px")?"-230px":"0px"; });
rightToggle.addEventListener("click",()=>{ rightPanel.style.right = (rightPanel.style.right=="0px")?"-230px":"0px"; });

// Create new list
document.getElementById("createListBtn").addEventListener("click",()=>{
  const name = document.getElementById("newListName").value.trim();
  const cols = document.getElementById("newListColumns").value.trim().split(",");
  const addDate = document.getElementById("newListDate").checked;
  const addCheckbox = document.getElementById("newListCheckbox").checked;
  if(!name || cols.length==0){ alert("Wpisz nazwƒô i kolumny"); return; }
  const newListRef = listsRef.push();
  newListRef.set({name:name,columns:cols,date:addDate,checkbox:addCheckbox,entries:{}});
  document.getElementById("newListName").value="";
  document.getElementById("newListColumns").value="";
  document.getElementById("newListDate").checked=false;
  document.getElementById("newListCheckbox").checked=false;
});

// Load and render lists
function loadLists(){
  listsRef.on("value", snapshot=>{
    const container = document.getElementById("listsContainer");
    container.innerHTML="";
    snapshot.forEach(listSnap=>{
      const list = listSnap.val();
      const listId = listSnap.key;
      const div = document.createElement("div");
      div.style.margin="20px";
      const h3 = document.createElement("h3");
      h3.textContent=list.name;
      div.appendChild(h3);

      // Form
      const form = document.createElement("form");
      form.style.marginBottom="10px";
      const entriesRef = listsRef.child(listId).child("entries");

      // Add inputs
      if(list.date){
        const dateInput = document.createElement("input");
        dateInput.type="date";
        dateInput.required=true;
        dateInput.name="date";
        form.appendChild(dateInput);
      }
      list.columns.forEach(col=>{
        const inp = document.createElement("input");
        inp.placeholder=col;
        inp.name=col;
        inp.required=true;
        form.appendChild(inp);
      });
      if(list.checkbox){
        const chk = document.createElement("input");
        chk.type="checkbox";
        chk.name="checkbox";
        form.appendChild(chk);
      }
      const submitBtn = document.createElement("button");
      submitBtn.type="submit";
      submitBtn.textContent="Dodaj wpis";
      form.appendChild(submitBtn);
      div.appendChild(form);

      // Table
      const table = document.createElement("table");
      const thead = document.createElement("tr");
      if(list.date) { const thDate=document.createElement("th"); thDate.textContent="Data"; thead.appendChild(thDate); }
      list.columns.forEach(c=>{ const th=document.createElement("th"); th.textContent=c; thead.appendChild(th); });
      if(list.checkbox){ const thChk=document.createElement("th"); thChk.textContent="Zrobione"; thead.appendChild(thChk); }
      if(isAdmin){ const thDel=document.createElement("th"); thDel.textContent="Akcje"; thead.appendChild(thDel);}
      table.appendChild(thead);
      const tbody = document.createElement("tbody");
      table.appendChild(tbody);
      div.appendChild(table);
      container.appendChild(div);

      // Add entry
      form.addEventListener("submit",e=>{
        e.preventDefault();
        const data={};
        if(list.date) data.date=form.querySelector("input[name='date']").value;
        list.columns.forEach(c=>{ data[c]=form.querySelector(`input[name='${c}']`).value; });
        if(list.checkbox) data.checkbox=form.querySelector("input[name='checkbox']").checked;
        entriesRef.push(data);
        form.reset();
      });

      // Render entries
      entriesRef.on("value",snap=>{
        tbody.innerHTML="";
        snap.forEach(entrySnap=>{
          const entry = entrySnap.val();
          const tr = document.createElement("tr");
          if(list.date) { const td=document.createElement("td"); td.textContent=entry.date; tr.appendChild(td);}
          list.columns.forEach(c=>{ const td=document.createElement("td"); td.textContent=entry[c]; tr.appendChild(td);});
          if(list.checkbox){ const td=document.createElement("td"); const cb=document.createElement("input"); cb.type="checkbox"; cb.disabled=true; cb.checked=entry.checkbox; td.appendChild(cb); tr.appendChild(td);}
          if(isAdmin){
            const td=document.createElement("td");
            const btn=document.createElement("button");
            btn.textContent="Usu≈Ñ";
            btn.addEventListener("click",()=>{ entriesRef.child(entrySnap.key).remove(); });
            td.appendChild(btn);
            tr.appendChild(td);
          }
          tbody.appendChild(tr);
        });
      });
    });
  });
}
</script>
</body>
</html>