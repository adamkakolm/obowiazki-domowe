<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ObowiÄ…zki Domowe</title>
<style>
:root{
  --primary:#4CAF50;--background:#f4f6f9;
  --surface:#fff;--text:#333;--shadow:0 4px 12px rgba(0,0,0,0.08);
}
body.dark{--background:#1e1e1e;--surface:#2c2c2c;--text:#ddd;}
body{margin:0;font-family:Arial, sans-serif;background:var(--background);color:var(--text);}

/* Topbar */
.topbar{position:fixed;top:0;left:0;right:0;background:var(--primary);color:white;
  padding:12px;display:flex;justify-content:space-between;z-index:1000;}
.topbar button{margin-right:6px;padding:6px 10px;border:none;border-radius:6px;cursor:pointer;}

/* Auth */
.auth-box{width:320px;margin:10vh auto;padding:20px;background:var(--surface);
  border-radius:10px;box-shadow:var(--shadow);text-align:center;}
.auth-box input{width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:8px;}

/* Sidebars */
.sidebar,.rightbar{
  position:fixed;top:60px;bottom:0;width:240px;background:var(--surface);
  box-shadow:var(--shadow);padding:12px;overflow:auto;transition:transform 0.3s ease;
  z-index:999;
}
.sidebar{left:0;transform:translateX(-100%);}
.sidebar.open{transform:translateX(0);}
.rightbar{right:0;transform:translateX(100%);}
.rightbar.open{transform:translateX(0);}
.sidebar button,.rightbar button{width:100%;margin:6px 0;padding:8px;border:none;
  background:var(--primary);color:white;border-radius:6px;cursor:pointer;}

/* Layout */
.layout{margin-top:70px;padding:20px;}
.main{max-width:1000px;margin:0 auto;background:var(--surface);
  padding:20px;border-radius:10px;box-shadow:var(--shadow);}

/* Form & Table */
#entryForm{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
#entryForm input{padding:8px;border:1px solid #ccc;border-radius:6px;}
#entryForm button{padding:8px 12px;background:var(--primary);color:white;border:none;
  border-radius:6px;cursor:pointer;}
table{width:100%;border-collapse:collapse;}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;}
th{background:var(--primary);color:white;}
</style>
</head>
<body>
<!-- LOGIN -->
<div id="login-screen">
  <div class="auth-box">
    <h2>ğŸ”‘ Logowanie</h2>
    <input id="username" placeholder="Login">
    <input id="password" type="password" placeholder="HasÅ‚o">
    <button onclick="login()">Zaloguj</button>
    <p>Nie masz konta? <a href="#" onclick="showRegister()">Rejestracja</a></p>
  </div>
</div>
<!-- REGISTER -->
<div id="register-screen" style="display:none">
  <div class="auth-box">
    <h2>ğŸ“ Rejestracja</h2>
    <input id="reg-username" placeholder="Login">
    <input id="reg-password" type="password" placeholder="HasÅ‚o">
    <button onclick="register()">Zarejestruj</button>
    <p><a href="#" onclick="showLogin()">Masz konto? Zaloguj</a></p>
  </div>
</div>
<!-- APP -->
<div id="app" style="display:none">
  <div class="topbar">
    <div>
      <button onclick="toggleSidebar()">â˜° Listy</button>
      <span id="userInfo"></span>
    </div>
    <div>
      <button onclick="toggleRightbar()">âš™ï¸</button>
      <button onclick="toggleDarkMode()">ğŸŒ“</button>
      <button onclick="logout()">ğŸšª</button>
    </div>
  </div>
  <!-- Sidebars -->
  <div class="sidebar" id="sidebar">
    <h3>ğŸ“‹ Listy</h3>
    <div id="lists"></div>
    <button onclick="newList()">â• Nowa lista</button>
  </div>
  <div class="rightbar" id="rightbar">
    <h3>âš™ï¸ Ustawienia</h3>
    <div id="settings"></div>
  </div>
  <!-- Main -->
  <div class="layout">
    <div class="main">
      <h2 id="currentListTitle">Lista: default</h2>
      <form id="entryForm"></form>
      <table>
        <thead><tr id="tableHead"></tr></thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyDeH4Ouu8XU09atWJMsawPrEsUCDTd8Pzo",
  authDomain:"obowiazki-domowe-b2312.firebaseapp.com",
  databaseURL:"https://obowiazki-domowe-b2312-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"obowiazki-domowe-b2312",
  storageBucket:"obowiazki-domowe-b2312.firebasestorage.app",
  messagingSenderId:"348397631566",
  appId:"1:348397631566:web:fef9f724dbf737b8cf6b1f"
});
const db=firebase.database();
let currentUser=null,currentList="default",listSettings={columns:["ObowiÄ…zek","UÅ¼ytkownik"],withDate:true};

// --- Auth ---
function showRegister(){loginScr().style.display="none";regScr().style.display="block";}
function showLogin(){loginScr().style.display="block";regScr().style.display="none";}
function loginScr(){return document.getElementById("login-screen");}
function regScr(){return document.getElementById("register-screen");}
function login(){
  const u=username.value.trim(),p=password.value;
  db.ref("users/"+u).get().then(s=>{
    if(s.exists()&&s.val().password===p){currentUser={name:u,role:s.val().role};afterLogin();}
    else alert("BÅ‚Ä™dne dane logowania");
  });
}
function register(){
  const u=document.getElementById("reg-username").value.trim(),p=document.getElementById("reg-password").value;
  db.ref("users/"+u).set({password:p,role:"user"}).then(()=>{alert("Zarejestrowano!");showLogin();});
}
function logout(){document.getElementById("app").style.display="none";loginScr().style.display="block";}

// --- UI ---
function toggleDarkMode(){document.body.classList.toggle("dark");}
function toggleSidebar(){document.getElementById("sidebar").classList.toggle("open");}
function toggleRightbar(){document.getElementById("rightbar").classList.toggle("open");}
function afterLogin(){
  loginScr().style.display=regScr().style.display="none";
  document.getElementById("app").style.display="block";
  document.getElementById("userInfo").innerText="ğŸ‘¤ "+currentUser.name+" ("+currentUser.role+")";
  loadLists();
  switchList("default");
}

// --- Lists ---
function loadLists(){
  db.ref("lists").on("value",snap=>{
    const l=document.getElementById("lists");l.innerHTML="";
    snap.forEach(ch=>{
      const n=ch.key;
      const btn=document.createElement("button");
      btn.innerText=n;
      btn.onclick=()=>switchList(n);
      l.appendChild(btn);
    });
  });
}
function newList(){
  const name=prompt("Nazwa nowej listy:");
  if(!name)return;
  db.ref("lists/"+name+"/settings").set({columns:["ObowiÄ…zek","UÅ¼ytkownik"],withDate:true});
}
function switchList(n){
  currentList=n;
  db.ref("lists/"+n+"/settings").get().then(s=>{
    if(s.exists()) listSettings=s.val();
    renderHead();renderForm();loadEntries();renderSettings();
    currentListTitle.innerText="Lista: "+n;
  });
}
function renderSettings(){
  const s=document.getElementById("settings");s.innerHTML="";
  listSettings.columns.forEach((c,i)=>{
    s.innerHTML+=`<div>Kolumna ${i+1}: <input value="${c}" onchange="editColumn(${i},this.value)"></div>`;
  });
  s.innerHTML+=`<button onclick="addColumn()">â• Dodaj kolumnÄ™</button>`;
  s.innerHTML+=`<div><label><input type="checkbox" ${listSettings.withDate?"checked":""} onchange="toggleDate(this.checked)"> Data</label></div>`;
  if(currentList!=="default") s.innerHTML+=`<button onclick="deleteList()">ğŸ—‘ï¸ UsuÅ„ listÄ™</button>`;
}
function editColumn(i,v){
  listSettings.columns[i]=v;
  db.ref("lists/"+currentList+"/settings").set(listSettings);
  renderHead();renderForm();renderSettings();
}
function addColumn(){
  listSettings.columns.push("Nowa kolumna");
  db.ref("lists/"+currentList+"/settings").set(listSettings);
  renderHead();renderForm();renderSettings();
}
function toggleDate(ch){
  listSettings.withDate=ch;
  db.ref("lists/"+currentList+"/settings").set(listSettings);
  renderHead();renderForm();renderSettings();
}
function deleteList(){
  if(confirm("UsunÄ…Ä‡ listÄ™ "+currentList+"?")){
    db.ref("lists/"+currentList).remove();
    switchList("default");
  }
}

// --- Entries ---
function renderHead(){
  const h=document.getElementById("tableHead");h.innerHTML="";
  listSettings.columns.forEach(c=>h.innerHTML+="<th>"+c+"</th>");
  if(listSettings.withDate) h.innerHTML+="<th>Data</th>";
}
function renderForm(){
  const f=document.getElementById("entryForm");f.innerHTML="";
  listSettings.columns.forEach(c=>f.innerHTML+=`<input id="form-${c}" placeholder="${c}">`);
  if(listSettings.withDate) f.innerHTML+=`<input id="form-date" type="date">`;
  f.innerHTML+=`<button type="button" onclick="addEntry()">Dodaj</button>`;
}
function addEntry(){
  const e={};listSettings.columns.forEach(c=>e[c]=document.getElementById("form-"+c).value);
  if(listSettings.withDate) e.date=document.getElementById("form-date").value;
  db.ref("lists/"+currentList+"/entries").push(e);
}
function loadEntries(){
  db.ref("lists/"+currentList+"/entries").on("value",snap=>{
    const b=document.getElementById("tableBody");b.innerHTML="";
    snap.forEach(ch=>{
      const e=ch.val();let tr=document.createElement("tr");
      listSettings.columns.forEach(c=>tr.innerHTML+=`<td>${e[c]||""}</td>`);
      if(listSettings.withDate) tr.innerHTML+=`<td>${e.date||""}</td>`;
      b.appendChild(tr);
    });
  });
}

// --- Ensure admin always exists/reset ---
db.ref("users/admin").set({password:"1234",role:"admin"});
db.ref("lists/default/settings").get().then(s=>{
  if(!s.exists()) db.ref("lists/default/settings").set({columns:["ObowiÄ…zek","UÅ¼ytkownik"],withDate:true});
});
</script>
</body>
</html>