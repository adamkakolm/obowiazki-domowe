<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Obowiązki Domowe</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
:root{
  --primary:#4CAF50;
  --secondary:#2e7d32;
  --background:#f4f6f9;
  --surface:#fff;
  --text:#333;
  --shadow:0 4px 12px rgba(0,0,0,0.08);
  --radius:10px;
}
body.dark{
  --background:#1e1e1e;
  --surface:#2c2c2c;
  --text:#ddd;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Segoe UI", Roboto, Arial,sans-serif;background:var(--background);color:var(--text);}
.topbar{position:fixed;top:0;left:0;right:0;background:var(--primary);color:white;padding:12px 20px;display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow);z-index:1200;}
.topbar button{background:white;color:var(--primary);border:none;padding:8px 10px;border-radius:8px;cursor:pointer;}
.auth-box{width:340px;margin:10vh auto;padding:26px;background:var(--surface);border-radius:12px;box-shadow:var(--shadow);text-align:center;}
.auth-box input{width:100%;padding:10px 12px;margin:8px 0;border-radius:8px;border:1px solid #ddd;}
.auth-box .link{color:var(--primary);cursor:pointer;text-decoration:underline;}
.side-panel{position:fixed;top:60px;bottom:0;width:300px;padding:18px;background:var(--surface);box-shadow:var(--shadow);overflow:auto;z-index:1100;transform:translateX(-110%);transition:transform .28s ease;}
.side-panel.right{right:0;transform:translateX(110%);}
.side-panel.open{transform:translateX(0);}
.panel-toggle{position:absolute;top:18px;right:-42px;background:var(--primary);color:white;border:none;width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--shadow);}
.main{margin:90px auto 60px auto;width:92%;max-width:1100px;background:var(--surface);padding:22px;border-radius:12px;box-shadow:var(--shadow);}
#entryForm{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
#entryForm select,#entryForm input{padding:10px;border-radius:8px;border:1px solid #ddd;flex:1;min-width:150px;}
#entryForm button{padding:10px 16px;border-radius:8px;border:none;background:var(--primary);color:white;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:14px;border-radius:8px;overflow:hidden;}
th,td{padding:12px;text-align:left;border-bottom:1px solid #eee;}
th{background:var(--primary);color:white;font-weight:600;cursor:pointer;}
tr:hover{background:#f7fff7;}
tr.done{background:#e0ffe0;}
tr.dark.done{background:#2a4a2a;}
button.action{background:transparent;border:none;cursor:pointer;font-size:18px;}
.center{text-align:center;}
.small{font-size:13px;color:#666;}
</style>
</head>
<body>
<!-- LOGIN -->
<div id="login-screen">
  <div class="auth-box">
    <h2>🔑 Logowanie</h2>
    <input id="username" placeholder="Nazwa użytkownika" />
    <input id="password" placeholder="Hasło" type="password" />
    <div style="margin-top:10px"><button onclick="login()">Zaloguj</button></div>
    <p class="small" style="margin-top:12px">Nie masz konta? <span class="link" onclick="showRegister()">Zarejestruj się</span></p>
  </div>
</div>
<!-- REGISTER -->
<div id="register-screen" style="display:none">
  <div class="auth-box">
    <h2>📝 Rejestracja</h2>
    <input id="reg-username" placeholder="Nazwa użytkownika" />
    <input id="reg-password" placeholder="Hasło" type="password" />
    <div style="margin-top:10px"><button onclick="register()">Zarejestruj</button></div>
    <p class="small" style="margin-top:12px"><span class="link" onclick="showLogin()">Masz konto? Zaloguj się</span></p>
  </div>
</div>
<!-- APP -->
<div id="app" style="display:none">
  <div class="topbar">
    <div class="left">
      <button onclick="togglePanel('left-panel')">☰</button>
      <div class="username" id="userInfo">—</div>
    </div>
    <div>
      <button onclick="togglePanel('right-panel')">📋 Listy</button>
      <button onclick="toggleDarkMode()">🌓</button>
      <button onclick="logout()" style="margin-left:8px">🚪 Wyloguj</button>
    </div>
  </div>
  <!-- Left panel -->
  <div id="left-panel" class="side-panel">
    <button class="panel-toggle" onclick="togglePanel('left-panel')">‹</button>
    <div class="panel-content">
      <h3>🔍 Filtry</h3>
      <input id="filterTask" placeholder="Obowiązek" />
      <input id="filterUser" placeholder="Użytkownik" style="margin-top:6px"/>
      <div style="margin-top:6px"><button onclick="applyFilters()">Filtruj</button> <button onclick="clearFilters()">Wyczyść</button></div>
      <hr style="margin:12px 0"/>
      <div id="admin-section" style="display:none">
        <h3>⚙️ Panel Admina</h3>
        <h4>➕ Dodaj obowiązek</h4>
        <input id="newTask" placeholder="Nowy obowiązek"/>
        <div style="margin-top:6px"><button onclick="addTask()">Dodaj</button></div>
        <h4 style="margin-top:10px">🗂 Zarządzanie listami</h4>
        <input id="listName" placeholder="Nazwa listy"/>
        <input id="col1" placeholder="Kolumna 1"/>
        <input id="col2" placeholder="Kolumna 2"/>
        <input id="col3" placeholder="Kolumna 3"/>
        <label><input type="checkbox" id="withDate"/> Z datą</label><br>
        <label><input type="checkbox" id="withCheck"/> Z checkbox</label><br>
        <button onclick="createList()">Utwórz listę</button>
        <div id="editListSection" style="margin-top:12px;"></div>
      </div>
    </div>
  </div>
  <!-- Right panel -->
  <div id="right-panel" class="side-panel right">
    <button class="panel-toggle" onclick="togglePanel('right-panel')">›</button>
    <div class="panel-content">
      <h3>📋 Listy</h3>
      <ul id="listMenu"></ul>
      <div class="small" style="margin-top:6px">Kliknij nazwę listy aby przełączyć, ❌ usuwa listę</div>
    </div>
  </div>
  <!-- Main -->
  <div class="main">
    <h2 id="currentListTitle">Obowiązki Domowe</h2>
    <form id="entryForm"></form>
    <table id="entriesTable">
      <thead><tr id="tableHead"></tr></thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
// Firebase
const firebaseConfig = {
  apiKey:"AIzaSyDeH4Ouu8XU09atWJMsawPrEsUCDTd8Pzo",
  authDomain:"obowiazki-domowe-b2312.firebaseapp.com",
  databaseURL:"https://obowiazki-domowe-b2312-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"obowiazki-domowe-b2312",
  storageBucket:"obowiazki-domowe-b2312.firebasestorage.app",
  messagingSenderId:"348397631566",
  appId:"1:348397631566:web:fef9f724dbf737b8cf6b1f"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let currentUser=null;
let currentList='default';
let listSettings={columns:["Obowiązek","Użytkownik"],withDate:true,withCheck:true};
let darkMode=false;

// Auth
function showRegister(){document.getElementById('login-screen').style.display='none';document.getElementById('register-screen').style.display='block';}
function showLogin(){document.getElementById('register-screen').style.display='none';document.getElementById('login-screen').style.display='block';}
function login(){
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value;
  if(!u||!p){alert('Wpisz login i hasło');return;}
  db.ref('users/'+u).get().then(snap=>{
    if(snap.exists() && snap.val().password===p){
      currentUser={name:u,role:snap.val().role||'user'};
      afterLogin();
    }else alert('Błędne dane logowania');
  });
}
function register(){
  const u=document.getElementById('reg-username').value.trim();
  const p=document.getElementById('reg-password').value;
  if(!u||!p){alert('Wpisz login i hasło');return;}
  db.ref('users/'+u).get().then(snap=>{
    if(snap.exists()){alert('Użytkownik już istnieje');return;}
    db.ref('users/'+u).set({password:p,role:'user'}).then(()=>{alert('Zarejestrowano!');showLogin();});
  });
}

// Utwórz domyślnego admina
function ensureAdminAccount() {
  db.ref("users/admin").get().then(snap => {
    if (!snap.exists()) {
      db.ref("users/admin").set({
        password: "1234",
        role: "admin"
      }).then(() => {
        console.log("Utworzono konto admin (login: admin, hasło: 1234)");
      });
    }
  });
}
ensureAdminAccount();
</script>
</body>
</html>