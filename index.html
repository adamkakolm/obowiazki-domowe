<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Obowiązki domowe - System</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f3f3f3; }
  header { background:#4caf50; color:white; padding:20px; text-align:center; }
  main { padding:20px; transition: margin 0.3s; }
  #loginScreen { display:flex; flex-direction:column; align-items:center; justify-content:center; height:80vh; }
  #loginScreen input, #loginScreen button { padding:10px; margin:5px; font-size:16px; }
  button { cursor:pointer; border:none; color:white; background:#4caf50; padding:10px 15px; border-radius:5px; }
  button:hover { background:#45a049; }
  table { width:90%; margin:20px auto; border-collapse: collapse; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  th, td { padding:10px; border:1px solid #ddd; text-align:center; }
  th { background:#4caf50; color:white; }
  tr:nth-child(even){ background:#f9f9f9;}
  tr:hover{ background:#e0f7e9;}
  /* Panele boczne */
  .sidePanel { position:fixed; top:0; height:100%; width:250px; background:#333; color:white; overflow:auto; transition: transform 0.3s; padding:20px; z-index:100; }
  #leftPanel { left:0; transform:translateX(-230px); }
  #rightPanel { right:0; transform:translateX(230px); }
  .panelBtn { position:fixed; top:50px; width:30px; height:30px; background:#4caf50; color:white; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:101; }
  #leftPanelBtn { left:0; }
  #rightPanelBtn { right:0; }
  .hidden { display:none; }
  input, select { padding:5px; margin:5px; }
</style>
</head>
<body>
<header>
  <h1>Obowiązki domowe 🏡</h1>
</header>

<!-- Ekran logowania -->
<div id="loginScreen">
  <h2>Logowanie / Rejestracja</h2>
  <input type="text" id="usernameInput" placeholder="Login">
  <input type="password" id="passwordInput" placeholder="Hasło">
  <button id="loginBtn">Zaloguj</button>
  <button id="registerBtn">Zarejestruj</button>
  <p id="loginError" style="color:red;"></p>
</div>

<!-- Lewy panel -->
<div id="leftPanel" class="sidePanel">
  <h3>Filtry</h3>
  <input type="date" id="filterDate">
  <input type="text" id="filterName" placeholder="Filtruj po użytkowniku">
  <select id="filterTask"><option value="">Wszystkie obowiązki</option></select>
  <button id="applyFilter">Filtruj</button>
  <button id="resetFilter">Resetuj</button>
  
  <div id="adminSection" class="hidden">
    <h3>Panel Admina</h3>
    <button id="clearAllBtn">Usuń wszystkie wpisy</button>
    <button id="exportCSVBtn">Eksportuj CSV</button>
    <h4>Nowe obowiązki</h4>
    <input type="text" id="newTaskInput" placeholder="Nowy obowiązek">
    <button id="addTaskBtn">Dodaj obowiązek</button>
    <h4>Konfiguracja wyglądu</h4>
    <label>Tło: <input type="color" id="bgColorPicker" value="#f3f3f3"></label><br>
    <label>Nagłówek: <input type="color" id="headerColorPicker" value="#4caf50"></label><br>
    <label>Przyciski: <input type="color" id="buttonColorPicker" value="#4caf50"></label><br>
    <button id="applyStyleBtn">Zastosuj</button>
  </div>
</div>
<div id="leftPanelBtn" class="panelBtn">&#9776;</div>

<!-- Prawy panel -->
<div id="rightPanel" class="sidePanel">
  <h3>Zarządzanie listami</h3>
  <div id="listSection" class="hidden">
    <input type="text" id="newListName" placeholder="Nazwa nowej listy">
    <label><input type="checkbox" id="useDateCheckbox"> Data?</label>
    <label><input type="checkbox" id="useCheckCheckbox"> Checkbox?</label>
    <button id="createListBtn">Stwórz listę</button>
    <div id="existingLists"></div>
  </div>
</div>
<div id="rightPanelBtn" class="panelBtn">&#9881;</div>

<!-- Główna zawartość -->
<main id="mainContent" class="hidden">
  <form id="taskForm">
    <input type="date" id="dateInput">
    <select id="taskSelect"><option value="" disabled selected>Wybierz obowiązek</option></select>
    <input type="text" id="taskNameInput" placeholder="Użytkownik" disabled>
    <button type="submit">Dodaj wpis</button>
  </form>
  <table id="taskTable">
    <thead><tr><th>Data</th><th>Obowiązek</th><th>Użytkownik</th><th>Akcje</th></tr></thead>
    <tbody></tbody>
  </table>
</main>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "TWOJE_API_KEY",
  authDomain: "TWOJE_AUTH_DOMAIN",
  databaseURL: "TWOJE_DB_URL",
  projectId: "TWOJE_PROJECT_ID",
  storageBucket: "TWOJE_STORAGE",
  messagingSenderId: "TWOJE_SENDER",
  appId: "TWOJE_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tasksRef = db.ref("tasks");
const usersRef = db.ref("users");
const listsRef = db.ref("lists");

let currentUser = null;
let isAdmin = false;

// Panele boczne
const leftPanel = document.getElementById("leftPanel");
const rightPanel = document.getElementById("rightPanel");
document.getElementById("leftPanelBtn").onclick=()=>{ leftPanel.style.transform = leftPanel.style.transform==='translateX(0px)' ? 'translateX(-230px)' : 'translateX(0)'; };
document.getElementById("rightPanelBtn").onclick=()=>{ rightPanel.style.transform = rightPanel.style.transform==='translateX(0px)' ? 'translateX(230px)' : 'translateX(0)'; };

// Logowanie
document.getElementById("loginBtn").onclick=()=>{
  const u=document.getElementById("usernameInput").value.trim();
  const p=document.getElementById("passwordInput").value;
  usersRef.child(u).get().then(s=>{
    if(s.exists() && s.val().password===p){
      currentUser=u; isAdmin=(s.val().role==='admin');
      initUI();
    } else { document.getElementById("loginError").textContent="Błędne dane"; }
  });
};
document.getElementById("registerBtn").onclick=()=>{
  const u=document.getElementById("usernameInput").value.trim();
  const p=document.getElementById("passwordInput").value;
  if(u&&p){
    usersRef.child(u).get().then(s=>{
      if(s.exists()) document.getElementById("loginError").textContent="Login zajęty";
      else { usersRef.child(u).set({password:p, role:"user"}); currentUser=u; initUI(); }
    });
  }
};

function initUI(){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainContent").classList.remove("hidden");
  document.getElementById("taskNameInput").value=currentUser;
  document.getElementById("adminSection").classList.toggle("hidden",!isAdmin);
  document.getElementById("listSection").classList.toggle("hidden",!isAdmin);
  loadTasks();
}

// Dodawanie wpisów
document.getElementById("taskForm").addEventListener("submit", e=>{
  e.preventDefault();
  const date=document.getElementById("dateInput").value;
  const task=document.getElementById("taskSelect").value;
  if(!task) return;
  tasksRef.push({date:date, task:task, user:currentUser});
});

// Ładowanie wpisów
function loadTasks(){
  tasksRef.on("value", snap=>{
    const tbody=document.querySelector("#taskTable tbody"); tbody.innerHTML="";
    snap.forEach(ch=>{
      const d=ch.val();
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${d.date||""}</td><td>${d.task}</td><td>${d.user}</td><td>${isAdmin?'<button onclick="deleteTask(\\''+ch.key+'\\')">Usuń</button>':""}</td>`;
      tbody.appendChild(tr);
    });
  });
}
function deleteTask(id){ tasksRef.child(id).remove(); }

// Dodawanie obowiązków
document.getElementById("addTaskBtn").onclick=()=>{
  const t=document.getElementById("newTaskInput").value.trim();
  if(t){ const opt=document.createElement("option"); opt.value=opt.textContent=t; document.getElementById("taskSelect").appendChild(opt); document.getElementById("newTaskInput").value=""; }
};

// Eksport CSV
document.getElementById("exportCSVBtn").onclick=()=>{
  tasksRef.once("value").then(snap=>{
    let csv="Data;Obowiązek;Użytkownik\\n";
    snap.forEach(ch=>{const d=ch.val(); csv+=`${d.date||""};${d.task};${d.user}\\n`;});
    const blob=new Blob([csv],{type:"text/csv"}); const a=document.createElement("a");
    a.href=URL.createObjectURL(blob); a.download="lista.csv"; a.click();
  });
};

// Czyszczenie
document.getElementById("clearAllBtn").onclick=()=>{ tasksRef.remove(); };

// Konfiguracja wyglądu
document.getElementById("applyStyleBtn").onclick=()=>{
  document.body.style.background=document.getElementById("bgColorPicker").value;
  document.querySelector("header").style.background=document.getElementById("headerColorPicker").value;
  document.querySelectorAll("button").forEach(b=>b.style.background=document.getElementById("buttonColorPicker").value);
};
</script>
</body>
</html>